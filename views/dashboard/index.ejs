<%- include('../partials/header', { title: 'Impact Dashboard', currentUser }) %>

<section class="section">
  <div class="section-header">
    <h1 class="section-title">Impact Dashboard</h1>
    <p class="section-subtitle">
      Filter by event type and participant demographics to see how experiences are leading to long-term success.
    </p>
  </div>

  <form class="filters filters-grid" method="GET">
    <div class="form-group">
      <label for="eventType">Event Type</label>
      <select id="eventType" name="eventType">
        <option value="">All</option>
        <% eventTypes.forEach(t => { %>
          <option value="<%= t %>"><%= t %></option>
        <% }) %>
      </select>
    </div>
    <div class="form-group">
      <label for="city">City</label>
      <select id="city" name="city">
        <option value="">All</option>
        <% cities.forEach(c => { %>
          <option value="<%= c %>"><%= c %></option>
        <% }) %>
      </select>
    </div>
    <div class="form-group">
      <label for="grade">Grade</label>
      <select id="grade" name="grade">
        <option value="">All</option>
        <% grades.forEach(g => { %>
          <option value="<%= g %>"><%= g %></option>
        <% }) %>
      </select>
    </div>
    <div class="form-group form-group-submit">
      <button class="btn btn-outline">Apply Filters (Preview only)</button>
    </div>
  </form>

  <div class="grid grid-4 kpi-grid">
    <% kpis.forEach(kpi => { %>
      <div class="card kpi-card">
        <div class="kpi-label"><%= kpi.label %></div>
        <div class="kpi-value"><%= kpi.value %></div>
      </div>
    <% }) %>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <h2>Participants Reached Over Time</h2>
      <canvas id="trendChart"></canvas>
    </div>
    <div class="card">
      <h2>Milestones Achieved</h2>
      <canvas id="milestoneChart"></canvas>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const trendLabels = <%- JSON.stringify(trendLabels || []) %>;
  const trendScores = <%- JSON.stringify(trendScores || []) %>;
  const milestoneLabels = <%- JSON.stringify(milestoneLabels || []) %>;
  const milestoneCounts = <%- JSON.stringify(milestoneCounts || []) %>;

  const trendCtx = document.getElementById('trendChart').getContext('2d');
  const milestoneCtx = document.getElementById('milestoneChart').getContext('2d');

  new Chart(trendCtx, {
    type: 'line',
    data: {
      labels: trendLabels,
      datasets: [{
        label: 'Participants Reached',
        data: trendScores,
        fill: false,
        tension: 0.2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } }
    }
  });

  new Chart(milestoneCtx, {
    type: 'bar',
    data: {
      labels: milestoneLabels,
      datasets: [{
        label: 'Milestones Achieved',
        data: milestoneCounts
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      plugins: { legend: { display: true } }
    }
  });
</script>

<%- include('../partials/footer') %>