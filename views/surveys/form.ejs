<%- include('../partials/header', { title: formTitle || 'Survey Form', currentUser, currentPath: '/surveys' }) %>

<section class="section">
  <a href="/surveys" class="btn btn-text" style="margin-bottom: 1rem; display: inline-block;">← Back to Surveys</a>
  <div class="section-header">
    <h1 class="section-title"><%= formTitle || 'Post-Event Survey' %></h1>
    <p class="section-subtitle">Record survey responses from participants.</p>
  </div>

  <div class="card card-narrow">
    <form action="<%= formAction %>" method="POST" class="form">
      <% if (typeof csrfToken !== 'undefined') { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>

      <div class="form-group">
        <label for="event_id">Event</label>
        <select id="event_id" name="event_id" required>
          <option value="">Select an event</option>
          <% events.forEach(ev => { %>
            <option value="<%= ev.id %>" <%= survey && survey.event_id === ev.id ? 'selected' : '' %>>
              <%= ev.name %>
            </option>
          <% }) %>
        </select>
      </div>

      <div class="form-group">
        <label for="participant_id">Participant</label>
        <select id="participant_id" name="participant_id" required>
          <option value="">Select a participant</option>
          <% participants.forEach(p => { %>
            <option value="<%= p.id %>" <%= survey && survey.participant_id === p.id ? 'selected' : '' %>>
              <%= p.first_name %> <%= p.last_name %>
            </option>
          <% }) %>
        </select>
      </div>

      <div class="form-group-inline">
        <div class="form-group">
          <label for="satisfaction">Satisfaction (1–5)</label>
          <input id="satisfaction" name="satisfaction" type="number" min="1" max="5" value="<%= survey?.satisfaction || '' %>" required>
        </div>
        <div class="form-group">
          <label for="usefulness">Usefulness (1–5)</label>
          <input id="usefulness" name="usefulness" type="number" min="1" max="5" value="<%= survey?.usefulness || '' %>" required>
        </div>
        <div class="form-group">
          <label for="recommend">Recommend (1–5)</label>
          <input id="recommend" name="recommend" type="number" min="1" max="5" value="<%= survey?.recommend || '' %>" required>
        </div>
      </div>

      <div class="form-group">
        <label for="comment">Comments</label>
        <textarea id="comment" name="comment" rows="4"><%= survey?.comment || '' %></textarea>
      </div>

      <div class="form-actions">
        <button class="btn btn-primary">Save</button>
        <a href="/surveys" class="btn btn-text">Cancel</a>
      </div>
    </form>
  </div>
</section>

<%- include('../partials/footer') %>