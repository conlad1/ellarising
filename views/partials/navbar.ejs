<%
  // Helper function to check if a path should be active
  function isActiveLink(linkPath, currentPath) {
    if (!currentPath) return false;
    
    // Special case for home page - only active if exactly "/"
    if (linkPath === '/') {
      return currentPath === '/';
    }
    
    // Special case for /events - should not match /events/admin
    if (linkPath === '/events') {
      return currentPath === '/events';
    }
    
    // For all other paths, check if currentPath starts with linkPath
    return currentPath.startsWith(linkPath);
  }
  
  const current = typeof currentPath !== 'undefined' ? currentPath : '';
  
  // Check if we're on an admin page
  const isAdminPage = current && currentUser && (
    current.startsWith('/dashboard') ||
    current.startsWith('/participants') ||
    current.startsWith('/events/admin') ||
    current.startsWith('/events/templates') ||
    (current.startsWith('/events/') && current !== '/events') || // Event instance routes (e.g., /events/:id, /events/new)
    current.startsWith('/surveys') ||
    current.startsWith('/milestones') ||
    current.startsWith('/donations') ||
    current.startsWith('/users')
  );
%>
<nav class="navbar">
  <div class="navbar-left">
    <a href="/" class="navbar-logo">
      <img src="/images/ellariseslogo.png" alt="Ella Rises" class="logo-image">
      <span class="logo-text">Ella Rises</span>
    </a>
  </div>

  <div class="navbar-center">
    <a href="/" class="nav-link <%= isActiveLink('/', current) ? 'active' : '' %>">Home</a>
    <a href="/programs" class="nav-link <%= isActiveLink('/programs', current) ? 'active' : '' %>">Programs</a>
    <a href="/events" class="nav-link <%= isActiveLink('/events', current) ? 'active' : '' %>">Events</a>
    <a href="/donate" class="nav-link <%= isActiveLink('/donate', current) ? 'active' : '' %>">Donate</a>
    <a href="/impact" class="nav-link <%= isActiveLink('/impact', current) ? 'active' : '' %>">Impact</a>
  </div>

  <div class="navbar-right">
    <% if (!currentUser) { %>
      <a href="/login" class="btn btn-outline">Login</a>
    <% } else { %>
      <span class="nav-user">
        Hi, <strong><%= currentUser.username %></strong>
        <span class="tag tag-small"><%= currentUser.role %></span>
      </span>
      <form action="/logout" method="POST" class="inline-form">
        <button class="btn btn-accent">Logout</button>
      </form>
    <% } %>
  </div>
</nav>

<% if (currentUser) { %>
<nav class="admin-subnav">
  <div class="admin-subnav-inner">
    <a href="/dashboard" class="admin-subnav-link <%= isActiveLink('/dashboard', current) ? 'active' : '' %>">Dashboard</a>
    <a href="/participants" class="admin-subnav-link <%= isActiveLink('/participants', current) ? 'active' : '' %>">Participants</a>
    <a href="/events/admin" class="admin-subnav-link <%= isActiveLink('/events/admin', current) ? 'active' : '' %>">Events Admin</a>
    <a href="/surveys" class="admin-subnav-link <%= isActiveLink('/surveys', current) ? 'active' : '' %>">Surveys</a>
    <a href="/milestones" class="admin-subnav-link <%= isActiveLink('/milestones', current) ? 'active' : '' %>">Milestones</a>
    <a href="/donations" class="admin-subnav-link <%= isActiveLink('/donations', current) ? 'active' : '' %>">Donations</a>
    <a href="/users" class="admin-subnav-link <%= isActiveLink('/users', current) ? 'active' : '' %>">Users</a>
  </div>
</nav>
<% } %>