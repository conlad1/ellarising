<%- include('../partials/header', { title: 'Donations â€“ Admin', currentUser }) %>

<section class="section">
  <div class="section-header header-with-actions">
    <div>
      <h1 class="section-title">Donations</h1>
      <p class="section-subtitle">
        Track gifts given to support Ella Rises programs and events.
      </p>
    </div>

    <% if (currentUser && currentUser.role === 'manager') { %>
      <a href="/donations/new" class="btn btn-primary">Record Donation</a>
    <% } %>
  </div>

  <form method="GET" class="filters filters-inline">
    <div class="form-group">
      <label for="q">Search</label>
      <input id="q" name="q" type="text" value="<%= q || '' %>" placeholder="Search by donor or email">
    </div>
    <button class="btn btn-outline">Filter</button>
  </form>

  <% if (!donations || donations.length === 0) { %>
    <p>No donations recorded yet.</p>
  <% } else { %>
    <table class="table">
      <thead>
        <tr>
          <th>Donor</th>
          <th>Email</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Source</th>
          <th class="table-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% donations.forEach(d => { %>
          <tr>
            <td><%= d.donor %></td>
            <td><%= d.email || '-' %></td>
            <td>$<%= d.amount.toFixed ? d.amount.toFixed(2) : d.amount %></td>
            <td><%= d.date %></td>
            <td><%= d.source || '-' %></td>
            <td class="table-actions">
              <% if (currentUser && currentUser.role === 'manager') { %>
                <a href="/donations/<%= d.id %>/edit" class="link-small">Edit</a>
                |
                <form action="/donations/<%= d.id %>/delete" method="POST" class="inline-form">
                  <button class="link-small link-danger" onclick="return confirm('Delete this donation?');">Delete</button>
                </form>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</section>

<%- include('../partials/footer') %>